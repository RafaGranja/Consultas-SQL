USE [CORPORE]
GO

/****** Object:  UserDefinedFunction [dbo].[FN_DELP_RETORNA_ITEM_MOVIMENTO_DESTINO]    Script Date: 14/08/2024 09:29:26 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		RAFAEL.GRANJA
-- Create date: 13/08/2024
-- Description:	FUNCAO PARA RETORNAR ITEM DE MOVIMENTO COM INFORMAÇÕES DO MOVIMENTO
-- =============================================
CREATE FUNCTION [dbo].[FN_DELP_RETORNA_ITEM_MOVIMENTO_DESTINO]
(	
	@CODCOLIGADA INT,
	@IDMOV INT,
	@NSEQ INT=NULL
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT T.SERIE,T.STATUS STATUSMOV,T.CODTMV,T.NUMEROMOV,TI.*
	FROM
	TITMMOVRELAC TL 
	INNER JOIN TMOV T ON T.CODCOLIGADA = TL.CODCOLDESTINO
	AND T.IDMOV = TL.IDMOVDESTINO
	INNER JOIN TITMMOV TI ON TI.CODCOLIGADA = TL.CODCOLDESTINO
	AND TI.IDMOV = TL.IDMOVDESTINO
	AND TI.NSEQITMMOV = TL.NSEQITMMOVDESTINO
	WHERE TL.CODCOLORIGEM=@CODCOLIGADA
	AND TL.IDMOVORIGEM=@IDMOV
	AND TL.NSEQITMMOVORIGEM=ISNULL(@NSEQ,TL.NSEQITMMOVORIGEM)

)
GO

