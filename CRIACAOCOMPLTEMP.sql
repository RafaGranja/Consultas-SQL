ALTER TABLE Z_CRM_ML001005
ALTER COLUMN OS VARCHAR(25) NOT NULL;
DROP INDEX IDCRIACAO ON Z_CRM_ML001005
ALTER TABLE Z_CRM_ML001005
ALTER COLUMN IDCRIACAO INT NOT NULL;
CREATE INDEX IDCRIACAO ON Z_CRM_ML001005 (OS,IDCRIACAO);
ALTER TABLE Z_CRM_ML001005
DROP CONSTRAINT PK_Z_CRM_ML001005;
ALTER TABLE Z_CRM_ML001005
ADD CONSTRAINT  PK_Z_CRM_ML001005 PRIMARY KEY(OS,IDCRIACAO);

SELECT DISTINCT QTDEUNCOMP FROM Z_CRM_ML001005

CREATE TABLE ZESTRUTURATEMP(
	ID INT IDENTITY(1,1) NOT NULL,
    DESCRICAO VARCHAR(120) COLLATE SQL_Latin1_General_CP1_CI_AI NOT NULL,
    NUMDESENHO VARCHAR(120) COLLATE SQL_Latin1_General_CP1_CI_AI NOT NULL,
    REVISAODESENHO VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AI,
    NUMDBI VARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AI,
    REVISAODBI VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AI,
    DESQTDE INT DEFAULT 1,
    TOTALQTDE INT DEFAULT 1,
    COMPRIMENTO NUMERIC(15,4),
    MATERIAL VARCHAR(90) COLLATE SQL_Latin1_General_CP1_CI_AI,
    OBSERVACOES VARCHAR(MAX) COLLATE SQL_Latin1_General_CP1_CI_AI,
    OS VARCHAR(25) COLLATE SQL_Latin1_General_CP1_CI_AI NOT NULL,
    DATAREVISAO DATETIME DEFAULT GETDATE(),
    PESOBRUTO NUMERIC(15,4),
    PESOLIQUIDO NUMERIC(15,4),
    OBSERVACOESDESENHO VARCHAR(MAX) COLLATE SQL_Latin1_General_CP1_CI_AI,
    PERIMETROCORTE NUMERIC(15,4),
    AREAPINTURA NUMERIC(15,4),
    OBSPROCESSO VARCHAR(MAX) COLLATE SQL_Latin1_General_CP1_CI_AI,
    OBSGERAL VARCHAR(MAX) COLLATE SQL_Latin1_General_CP1_CI_AI,
    TIPODESENHO VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AI,
    ESPESSURA NUMERIC(15,4),
    LARGURA NUMERIC(15,4),
    BITOLA NUMERIC(15,4),
    MASSALINEAR NUMERIC(15,4),
    DIAMETROEXTERNO NUMERIC(15,4),
    DIAMETROINTERNO NUMERIC(15,4),
    ESPROSCA NUMERIC(15,4),
    CODIGOPRD VARCHAR(30) COLLATE SQL_Latin1_General_CP1_CI_AI,
    POSICAODESENHO VARCHAR(120) COLLATE SQL_Latin1_General_CP1_CI_AI,
    AREASECAO NUMERIC(15,4),
    ALTURA NUMERIC(15,4),
    ESPALMA NUMERIC(15,4),
    POSICAOINDICE INT DEFAULT 1,
    PRODUTORM VARCHAR(160) COLLATE SQL_Latin1_General_CP1_CI_AI,
    IDPRD INT,
    UNDMEDIDA VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AI,
    LARGURAABA NUMERIC(15,4),
    ESPABA NUMERIC(15,4),
    COMPORLISTA VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AI,
    DESCOS VARCHAR(254) COLLATE SQL_Latin1_General_CP1_CI_AI,
    NUMDOCDELP VARCHAR(90) COLLATE SQL_Latin1_General_CP1_CI_AI,
    REVISAODOCDELP VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AI,
    CODCOLIGADA INT,
    CODFILIAL INT,
    DIAMETROEXTERNODISCO NUMERIC(15,4),
    DIAMETROINTERNODISCO NUMERIC(15,4),
    CHECKUSINAGEM VARCHAR(1) DEFAULT 'N' COLLATE SQL_Latin1_General_CP1_CI_AI,
    CHECKCALDERARIA VARCHAR(1) DEFAULT 'N' COLLATE SQL_Latin1_General_CP1_CI_AI,
    CODTRFPAI VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AI,
    NOMETRFPAI VARCHAR(90) COLLATE SQL_Latin1_General_CP1_CI_AI,
    EXECUCOES INT DEFAULT 1,
    PESOUNITARIO NUMERIC(15,4), 
    OPSUNITARIAS VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AI,
    QTDEUNCOMP VARCHAR(15) COLLATE SQL_Latin1_General_CP1_CI_AI,
    IDCRIACAO INT DEFAULT 1,
    IDCRIACAOPAI INT DEFAULT 0,
    ITEMEXCLUSIVO INT DEFAULT 0,
	ITEMDERETORNO INT,
    RECCREATEDBY VARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AI NOT NULL DEFAULT 'fluig',
    RECCREATEDON DATETIME NOT NULL DEFAULT GETDATE(),
    RECMODIFIEDBY VARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AI NOT NULL DEFAULT 'fluig',
    RECMODIFIEDON DATETIME NOT NULL DEFAULT GETDATE(),
	INDEX IDCRIACAO (OS,IDCRIACAO),
	INDEX COFTRF (OS,CODTRFPAI,IDCRIACAO),
	INDEX OS (OS),
	CONSTRAINT PK_IDCRIACAO PRIMARY KEY ( OS,IDCRIACAO ),
	CONSTRAINT FK_IDCRIACAO FOREIGN KEY ( OS,IDCRIACAO ) REFERENCES Z_CRM_ML001005 (OS,IDCRIACAO),
	CONSTRAINT CK_TIPODESENHO CHECK (TIPODESENHO IN ('SEMIACABADO','ACABADO','NAOMANUFATURADO','INDUSTRIALIZACAO',NULL)),
	CONSTRAINT CK_UNDMEDIDA CHECK (UNDMEDIDA IN ('CJ','UN','PC',NULL)),
	CONSTRAINT CK_COMPORLISTA CHECK (COMPORLISTA IN ('SIM',NULL)),
	CONSTRAINT CK_OPSUNITARIAS CHECK (OPSUNITARIAS IN ('SIM',NULL)),
	CONSTRAINT CK_CHECKUSINAGEM CHECK (CHECKUSINAGEM IN ('S','N',NULL)),
	CONSTRAINT CK_CHECKCALDERARIA CHECK (CHECKCALDERARIA IN ('S','N',NULL)),
	CONSTRAINT CK_QTDEUNCOMP CHECK (QTDEUNCOMP IN ('PESOUNITARIO','DESENHO',NULL)),
	CONSTRAINT CK_ITEMEXCLUSIVO CHECK (ITEMEXCLUSIVO IN (0,1,2)),
)